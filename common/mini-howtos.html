<!DOCTYPE HTML>
<!-- Copyright (c) 2011, Everit Kft.

    All rights reserved.

    This library is free software; you can redistribute it and/or
    modify it under the terms of the GNU Lesser General Public
    License as published by the Free Software Foundation; either
    version 3 of the License, or (at your option) any later version.

    This library is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
    Lesser General Public License for more details.

    You should have received a copy of the GNU Lesser General Public
    License along with this library; if not, write to the Free Software
    Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston,
    MA 02110-1301  USA -->
<html>
<head>
<meta charset="utf-8">
<title>Everit Cookbook - Mini howtos</title>
<link rel="icon" type="image/ico" href="../fonts/favicon.ico">

<!--    <link rel="stylesheet" type="text/css" href="../common/css/base.css">-->
<link href="../css/bootstrap.min.css" rel="stylesheet">
<link href="../css/docs.min.css" rel="stylesheet">
<link href="../css/everit.css" rel="stylesheet">
<script type="text/javascript">
	var _gaq = _gaq || [];
	_gaq.push([ '_setAccount', 'UA-15041869-4' ]);
	_gaq.push([ '_setDomainName', 'everit.org' ]);
	_gaq.push([ '_trackPageview' ]);
</script>
</head>
<body>

  <header class="navbar navbar-static-top bs-docs-nav" id="top" role="banner">
    <div class="container">
      <div class="navbar-header">
        <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
          <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span
            class="icon-bar"></span>
        </button>
        <a href="../index.html" class="navbar-brand">Index</a>
      </div>
      <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
        <ul class="nav navbar-nav">
          <li><a href="https://github.com/everit-org" target="_blank">Sources</a></li>
          <li><a href="http://www.everit.org/" target="_blank">Community</a></li>

        </ul>
        <ul class="nav navbar-nav navbar-right">
          <li><a href="http://www.everit.biz" target="_blank">Enterprise</a></li>
          <li><a href="http://everitorg.wordpress.com/" target="_blank">Blog</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <div class="bs-docs-masthead everit-header" id="content" role="main">
    <div class="container">
      <span class="bs-docs-booticon bs-docs-booticon-lg bs-docs-booticon-outline"> <img class="logo"
        src="../fonts/sbz_e.svg" alt="E">
      </span>
      <p class="lead">Mini How-to collection</p>
    </div>
  </div>

  <div class="container">
    <div class="col-md-10">
      <div class="bs-docs-featurette cookbook" id="content_description">
        <h2>Task How-to collection</h2>
        <p>This section describes the common tasks carried out within the steps of the cookbook. Since many of these
          tasks are repeated many times throughout the book, it is better to have a section dedicated to describe these
          specific tasks so that its relevant paragraphs can be linked, whenever it is necessary.</p>
      </div>

      <hr class="featurette-divider">
      <div class="bs-docs-featurette cookbook" id="open_view_in_eclipse">
        <h2 id="open_views_in_eclipse">Open a view in Eclipse</h2>
        <p>Views are sub-windows in Eclipse. Views can be resized, or placed into any area of the workspace. To open
          a view that is not yet on the screen, select the "Window -&gt; Show View" menu item. There are some views by
          default in the list, but if you cannot find the view you are looking for there, you can search for other views
          by selecting the "Other..." menu item.</p>
      </div>

      <hr class="featurette-divider">
      <div class="bs-docs-featurette cookbook" id="gitignore">
        <h2 id="git_ignore_for_eclipse_java_project">Setting .gitignore for Eclipse based java project</h2>
        <p>
          One of the great things you get with maven is that you do not have to commit the settings of your IDE with the
          sources into your version control system. It is also a common mistake if a developer commits the compiled
          binaries, thereby making the size of the repository irreversibly large. In case of Eclipse based Java
          projects, many issues can be solved by <a href="#open_system_file_with_eclipse">creating/appending</a> a
          .gitignore file into the root of every maven project (also to the root of sub-modules) with at least the
          following content:
        </p>
      </div>
      <pre class="prettyprint">
/.settings
/target
/.classpath
/.project
/.checkstyle
</pre>
      <p>Based on the plugins you use in your IDE, other files should also be included in .gitignore.</p>

      <hr class="featurette-divider">
      <div class="bs-docs-featurette cookbook" id="checking_out_from_github_in_eclipse">
        <h2>Checking out a repository from Github in Eclipse</h2>
        <ol>
          <li><p>Start Eclipse.</p></li>
          <li><p>Switch to the "Git Repository Exploring" perspective in Eclipse. (Window -&gt; Open
              perspective -&gt; Other..., Select the perspective from the list)</p></li>
          <li><p>On the left side, you see the "Git Repositories" window. Click on the "Clone button".</p> <img
            class="screenshot" src="clone_git_repository.gif" /></li>
          <li><p>In the "Clone Git Repository" window, enter the URL of the Git repository as you see below.</p> <img
            class="screenshot" src="source_git_repository.gif" /></li>
          <li><p>
              Click Next, Next and Finish. The repository should be checked out to the "<span
                style="font-style: italic;">USER_HOME</span>/git/<span style="font-style: italic;">REPO_NAME</span>"
              directory.
            </p></li>
        </ol>
      </div>

      <hr class="featurette-divider">
      <div class="bs-docs-featurette cookbook" id="ds_and_metatype_in_pom">
        <h2>Adding Declarative Services and Metatype code generation to the pom.xml</h2>
        <p>
          <a href="http://wiki.osgi.org/wiki/Declarative_Services">Declarative Services</a> allows the programmers to
          define components that are instantiated based on configuration. <a
            href="http://blog.osgi.org/2011/03/metatypes.html">Metatype</a> allows us to define the configuration
          possibilities of a Component in a way that it can appear on the OSGi Web Console as well. Component structures
          and their configuration possibilities can be defined via XML files. However, it is also possible to put these
          definitions as annotations into the Java source. There are several annotation sets and code generators for
          Declarative Services and Metatype. Since the Felix implementation has the best support for maven-eclipse, it
          is presented in the following example. To use the Felix implementation, put the following snippet into the
          pom.xml file of the project:
        </p>
        <pre class="prettyprint lang-xml">
  &lt;build&gt;
    ...
    &lt;plugins&gt;
      ...
      &lt;plugin&gt;
        &lt;groupId&gt;org.apache.felix&lt;/groupId&gt;
        &lt;artifactId&gt;maven-scr-plugin&lt;/artifactId&gt;
        &lt;version&gt;1.20.0&lt;/version&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;id&gt;generate-scr-scrdescriptor&lt;/id&gt;
            &lt;goals&gt;
              &lt;goal&gt;scr&lt;/goal&gt;
            &lt;/goals&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;
      ...
    &lt;/plugins&gt;
    ...  
  &lt;/build&gt;
 
  &lt;dependencies&gt;
    ...
    &lt;dependency&gt;
      &lt;groupId&gt;org.apache.felix&lt;/groupId&gt;
      &lt;artifactId&gt;org.apache.felix.scr.annotations&lt;/artifactId&gt;
      &lt;version&gt;1.9.8&lt;/version&gt;
    &lt;/dependency&gt;
    ...
  &lt;/dependencies&gt;</pre>
        <p>This code generator (as all the others) checks the classes for annotations, extends the MANIFEST headers
          and generates the standard Declarative Services and Metatype XMLs in the target/classes folder of the project.
          This means that during runtime, the DS and Metatype technologies do not use the annotations, but only the XML
          and MANIFEST header entries.</p>
        <p>As soon as m2e-lifecycle is available for the standard org.osgi.* annotations, this part of the tutorial
          will be replaced with the description of that annotation set.</p>
      </div>

      <hr class="featurette-divider">
      <div class="bs-docs-featurette cookbook" id="creating_a_property">
        <h2>Creating a class property in Eclipse</h2>
        <p>Java properties are member variables with getter and setter methods. In the most cases, these member
          variables are private. There are several ways to create properties. Here is an example of creating a property
          "private long fooId":</p>
        <ol>
          <li><p>Create the member variable in the class by typing it:</p> <pre class="prettyprint lang-java">
public class Foo {

  <b>private long fooId;</b>
}</pre></li>
          <li><p>Generate getters and setters. You have several options:</p>
            <ul>
              <li><p>
                  <b>Option 1:</b> start typing "set" in the source of the class and press CTRL+SPACE. The content
                  assist will appear and let you select the setter method. If you select that, the setter will be
                  generated right there. You can generate the getter in the same way.
                </p></li>
              <li><p>
                  <b>Option 2:</b> Press ALT+SHIFT+S in the source of the class and select "Generate getters and
                  setters" from the context menu. In the dialog, you can select, which getters and setters you would
                  like to generate.
                </p></li>
            </ul></li>
          <li><p>The final code should look like this:</p> <pre class="prettyprint lang-java">
public class Foo {

	private long fooId;
	
	public long getFooId() {
		return fooId;
	}
	
	public void setFooId(long fooId) {
		this.fooId = fooId;
	}
}</pre></li>
        </ol>
      </div>

      <hr class="featurette-divider">
      <div class="bs-docs-featurette cookbook" id="start_osgi_container">
        <h2>Starting the dev OSGi container</h2>
        <ol>
          <li><p>
              Run <i>"mvn eosgi:dist"</i> on the tests project! If you ran <i>mvn install</i> previously and you have
              not deleted the target folder since, you can skip this one.
            </p></li>
          <li><p>
              Go to the <i>tests/target/eosgi-dist/felixtest/bin</i> folder and open a command line
            </p></li>
          <li><p>Start the Development OSGi container</p>
            <ul>
              <li><p>
                  Windows: <i>runConsole.bat</i>
                </p></li>
              <li><p>
                  Linux: <i>./runConsole.sh</i>
                </p></li>
            </ul>
            <p>
              After the application is started, an always-on-top <i>OSGi Deployer</i> window will appear.
            </p> <img class="img-responsive img-thumbnail" src="deployer_window.png" alt="Deployer window" />
            <p>
              We will use that window to deploy our changes rapidly. For more information about richconsole, please see
              the <a href="https://github.com/everit-org/osgi-richconsole">documentation</a> of the project!
            </p></li>
        </ol>
      </div>

      <hr class="featurette-divider">
      <div class="bs-docs-featurette cookbook" id="deploy_to_osgi_container">
        <h2>Deploy project(s) to the OSGi container</h2>
        <p>You have several ways of deploying projects to the development OSGi container:</p>
        <ul>
          <li><p>Drag one or more projects from the Project Explorer of Eclipse or a file manager and drop them to the deployer
              window. In case of this choice, the <i>target/classes</i> folder of the project must be up-to-date.</p></li>
              <li><p>Re-package the module with maven and drop the generated JAR to the deployer window.</p></li>
        </ul>
      </div>

      <hr class="featurette-divider">
      <div class="bs-docs-featurette cookbook" id="immutable_dto">
        <h2>Implementing a serializable immutable DTO</h2>
        <p>There are many articles on the internet how to develop an immutable DTO. The requirements of a DTO are
          the followings:</p>
        <ul>
          <li><p>A DTO should be serializable.</p></li>
          <li><p>A DTO should be deserializable from custom formats like JSON.</p></li>
          <li><p>A DTO should be immutable. In case a DTO is not immutable, it cannot be used by caches.</p></li>
        </ul>
        <p>It is hard to satisfy all of the requirements in Java (if not impossible). An almost good sample is the
          following:</p>
        <pre class="prettyprint lang-java">
package test.test;

import java.io.Serializable;

public final class ImmutableDTOClass implements Serializable {

    private static final long serialVersionUID = -195005209277061131L;

    protected OtherImmutableDTOClass immutableProperty;

    protected ImmutableDTOClass() {
    }

    public ImmutableDTOClass(OtherImmutableDTOClass immutableProperty) {
        this.immutableProperty = immutableProperty;
    }

    public OtherImmutableDTOClass getImmutableProperty() {
        return immutableProperty;
    }
}
</pre>
        <p>During the implementation of the class, the following rules were applied:</p>
        <ul>
          <li><p>
              Implement the <i>Serializable</i> interface and generate a <i>serialVersionUID</i> constant! Technologies
              will be able to use basic java serialization in this way that might be the fastest option to send process
              remote objects.
            </p></li>
          <li><p>Use only immutable classes for property types! If it is not possible, always clone the value
              of the property in the getter and return the cloned instance!</p></li>
          <li><p>
              Create a <i>protected</i> empty constructor! If there is not one, custom serializers will not be able to
              instantiate the class. Well, they could with <a href="http://objenesis.org/">objenesis</a> but if not
              necessary, it is not too good to use such evil tricks. Protected constructor can be used via reflection
              without calling <i>setAccessible(true)</i>.
            </p></li>
          <li><p>
              Qualify the member variables to be <i>protected</i>! The reason is the same as with constructor. They
              should be accessible by custom serializers without using evil tricks.
            </p></li>
          <li><p>Qualify the class to be final! There should be no possibility to create a mutuable subclass of
              our immutable class.</p></li>
        </ul>
        <p>The solution is nearly perfect. The only issue is that the properties can be modified without reflection
          from classes that are located in the same package. Well, the one who does modification in the same package,
          should know what he/she does.</p>
      </div>

      <div></div>
      <footer class="bs-docs-footer" role="contentinfo">
        <div class="container">
          <div class="bs-docs-social">
            <ul class="bs-docs-social-buttons">
              <li class="follow-btn "><a href="https://twitter.com/EveritOrg" class="twitter-follow-button"
                data-show-count="true">Follow @EveritOrg</a></li>
              <li class="tweet-btn"><a href="https://twitter.com/share" class="twitter-share-button"
                data-url="http://www.everit.org/">Tweet</a></li>
            </ul>
          </div>
        </div>
      </footer>

      <!-- Bootstrap core JavaScript
================================================== -->
      <!-- Placed at the end of the document so the pages load faster -->
      <script src="../js/jquery-2.1.1.min.js"></script>
      <script src="../js/bootstrap.min.js"></script>
      <script src="../js/everit.js "></script>
      <script src="../js/prettify/run_prettify.js"></script>
      <script type="text/javascript">
							(function() {
								var ga = document.createElement('script');
								ga.type = 'text/javascript';
								ga.async = true;
								ga.src = ('https:' == document.location.protocol ? 'https://ssl'
										: 'http://www')
										+ '.google-analytics.com/ga.js';
								var s = document.getElementsByTagName('script')[0];
								s.parentNode.insertBefore(ga, s);
							})();
						</script>
    </div>
  </div>
</body>
</html>